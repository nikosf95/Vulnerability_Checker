import pandas as pd
import numpy as np
import matplotlib.pyplot as plt; plt.rcdefaults()
import matplotlib
import matplotlib.pyplot as plt
from pylab import title, figure, xlabel, ylabel, xticks, bar, legend, axis, savefig
from fpdf import FPDF
import os,csv,sys,subprocess

pathtospiders = os.path.abspath(os.getcwd()) + "/web_scraping/web_scraping/spiders"

pathtowebscraping = os.path.abspath(os.getcwd()) + "/web_scraping"

pathtorapid7 = os.path.abspath(os.getcwd()) + "/web_scraping/web_scraping/spiders/rapid7.csv"

pathtocveno = os.path.abspath(os.getcwd()) + "/web_scraping/web_scraping/spiders/cve_no.csv"

pathtodetails = os.path.abspath(os.getcwd()) + "/web_scraping/web_scraping/spiders/details.csv"

with open(pathtorapid7, 'w') as fw:
    fw.close()

with open(pathtocveno, 'w') as fw:
    fw.close()

with open(pathtodetails, 'w') as fw:
    fw.close()

subprocess.call("scrapy crawl rapid7 -o rapid7.csv", shell=True, cwd=pathtospiders)
subprocess.call("python search.py", shell=True, cwd=pathtowebscraping)
subprocess.call("scrapy crawl get_cves -o cve_no.csv", shell=True, cwd=pathtospiders)
subprocess.call("scrapy crawl cve_details -o details.csv", shell=True, cwd=pathtospiders)
subprocess.call("python create_assesment.py", shell=True, cwd=pathtowebscraping)
subprocess.call("del *.csv", shell=True, cwd=pathtospiders)
subprocess.call("del *.pyc", shell=True, cwd=pathtospiders)
subprocess.call("del *.pyc", shell=True, cwd=pathtowebscraping+"/web_scraping")

