# This is a spider that collects data from cve details
import scrapy,os,sys,re,csv
from web_scraping.items import CVSS
import unicodedata
import wmi

w = wmi.WMI()
dir = os.path.abspath(os.getcwd()) + "/cve_no.csv"
class QuotesSpider(scrapy.Spider):
    results=()
    start_urls=[ 'https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-']
    
    with open(dir) as f_obj:
        reader = csv.reader(f_obj, delimiter=',')
        for line in reader:
            line[0].replace('\n', '')
            line[0].replace(' ', '')
            start_urls.append('https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-'+line[0])    
    name = "cve_details"

    def parse(self, response):
        item = CVSS()
        

        
        for quote in response.css('table#cvssscorestable'):
            item['score'] = quote.css('div.cvssbox::text').get() # save the result into item in order to store it in a better csv format
        item['cve_id'] = response.css('#cvedetails > h1 > a::text').get()
        if item['cve_id'] != None:

            yield item
        else:
            pass

            
          
